# Требования к приложению и проверка работы

## Обзор

Данный документ содержит полный список требований к мобильному приложению, включая технические спецификации, требования платформ и процедуры тестирования.

## Содержание

- [Трекинговая ссылка](#трекинговая-ссылка)
- [Тестовый оффер](#тестовый-оффер)
- [Размер приложения](#размер-приложения)
- [Требования площадок к Privacy Policy](#требования-площадок-к-privacy-policy)
- [Минимальные требования API](#минимальные-требования-api)
- [Адаптивная иконка](#адаптивная-иконка)
- [Экран загрузки](#экран-загрузки)
- [Запрос на отслеживание данных](#запрос-на-отслеживание-данных)
- [Запрос на отправку уведомлений](#запрос-на-отправку-уведомлений)
- [Загрузка вебвью](#загрузка-вебвью)
- [Замена Useragent](#замена-useragent)
- [Размер вебвью](#размер-вебвью)
- [Поворот экрана](#поворот-экрана)
- [Возврат назад](#возврат-назад)
- [Множественные редиректы](#множественные-редиректы)
- [Поддержка Javascript](#поддержка-javascript)
- [Поддержка Cookie](#поддержка-cookie)
- [Поддержка сессий](#поддержка-сессий)
- [Поддержка inline autoplay video](#поддержка-inline-autoplay-video)
- [Поддержка автоматического разрешения protected content](#поддержка-автоматического-разрешения-protected-content)
- [Получение параметров](#получение-параметров)
- [Загрузка файлов](#загрузка-файлов)
- [Перекрытие контента клавиатурой](#перекрытие-контента-клавиатурой)
- [Получение уведомлений](#получение-уведомлений)
- [Отображение уведомлений](#отображение-уведомлений)
- [Открытие уведомления](#открытие-уведомления)
- [Запуск новой ссылки](#запуск-новой-ссылки)
- [Переход по диплинку](#переход-по-диплинку)

---

## Трекинговая ссылка

Трекинговая ссылка Appsflyer используется для имитации неорганической установки приложения.

<aside>
❔

Для проверки работы приложения до его публикации следует совершить переход по трекинговой ссылке непосредственно перед тестовой установкой, предварительно дополнив ссылку параметром `&advertising_id={GAID/IDFA}`.
GAID/IDFA тестового устройства должен быть добавлен в список Test Devices связанного AppsFlyer аккаунта.

</aside>

В качестве тестовой трекинговой ссылки используется ссылка следующего вида:

```json
https://app.appsflyer.com/com.example.app?pid=Test%20Source&c=testsub_testsub2_testsub_testsub_testsub_testsub_testsub_testsub1%20%23extra&siteid=test&adset=testsub&af_adset=testsub3&af_c_id=testsub4&agency=Test%20Agency&af_sub1=testextra2&af_sub2=testextra3&af_sub3=testextra4&af_sub4=testextra5&af_sub5=testextra6&is_retargeting=true
```

- Либо используется Onelink ссылка с аналогичным набором параметров:
    
    ```json
    campaign = testsub_testsub2_testsub_testsub_testsub_testsub_testsub_testsub1 #extra
    
    adset = testsub
    
    af_adset = testsub3
    
    campaign_id = testsub4
    
    media_source = Test Source
    
    af_sub1 = testextra2
    
    af_sub2 = testextra3
    
    af_sub3 = testextra4
    
    af_sub4 = testextra5
    
    af_sub5 = testextra6
    
    agency = Test Agency
    
    is_retargeting = true
    ```
    

# Тестовый оффер

Для тестирования приложений используется следующая ссылка:

https://test-web.syndi-test.net/

По данной ссылке распологается ресурс, в рамках которого частично проверяется работа вебвью и логика приложения. 

Выполнение всех условий, указанных на ресурсе, на 100% не гарантирует правильной работы приложения. Отдельные части приложения следует перепроверять вручную в разных сценариях.

Кроме описанных здесь и на ресурсе сценариев следует проверять правильность реализации пользовательского опыта в целом, включая плавность работы вебвью, время загрузок, качество используемых изображений, соответствие поведения приложения ожиданиям пользователя и прочее.

Ниже описаны некоторые из сценариев и требований к работе приложений, которые необходимо проверять.

# Размер приложения

Необходимо минимизировать размер приложения. 

- Оптимальный размер **до 30 мб**.
- Размер пакета 100+ мб - недопустим.

# Требования площадок к Privacy Policy

В приложении должен быть доступ к privacy policy (ссылка/текст) согласно требованиям [AppStore](https://developer.apple.com/app-store/review/guidelines/#5.1.1) и [Google Play](https://support.google.com/googleplay/android-developer/answer/10144311?hl=en-GB).

# Минимальные требования API

Минимальные ограничения для системных API должны быть на столько низкими, на сколько это позволяет текущая политика стора и используемые SDK.
(Для Android API level 35 для iOS 18)

# Адаптивная иконка

Изображение, используемое в качестве иконки приложения, должно быть точно вписано в иконку, не иметь полей и не иметь обрезанного контента.

- Подробнее
    
    https://developer.android.com/distribute/google-play/resources/icon-design-specifications
    
    https://developer.apple.com/design/human-interface-guidelines/app-icons
    
    https://adaptive-icon-tester.nabettu.com/
    

# Экран загрузки

- Экран загрузки приложения должен отражать дизайн приложения и иметь **анимированный индикатор** загрузки.
- Экран загрузки должен адаптироваться под вертикальное и горизонтальное положение экрана.
- Первая и последующие загрузки приложения не должны длиться долго. При нормальной скорости интернета время загрузки не должно превышать 10 секунд.

# Запрос на отслеживание данных

**iOS** приложение должно отображать запрос на отслеживание данных пользователя.

[Это исходит из требований AppsFlyer для сбора IDFA. В случае если AppsFlyer не используется данное требование может быть пересмотрено.](https://support.appsflyer.com/hc/en-us/articles/207032086-Preparing-for-the-App-Store-review-nutrition-labels)

# Запрос на отправку уведомлений

Приложение должно отображать кастомный экран с предложением получать уведомления перед запуском вебвью. 

Кастомный экран запроса должен адаптироваться под вертикальное и горизонтальное положение экрана.

Согласие должно приводить к отображению системного запроса на отправку уведомлений.

Отказ от уведомлений на кастомном экране откладывает следующее отображение этого экрана на 3 дня.

Отказ от уведомлений в системном запросе приводит к невозможности отобразить этот запрос еще раз. 

Следует проверять все три варианта сценария:

- соглашение на отправку уведомлений при первом запуске
- соглашение на отправку уведомлений спустя три дня
- полный отказ от уведомлений

# Загрузка вебвью

Загрузка вебвью должна происходить при выполнении определенных условий, по умолчанию при неорганической установке. 

Вместе с неорганической установкой и запуском вебвью необходимо тестировать органическую установку. На органической установке при станадртных тестовых настройках не должен запускаться вебвью, а так же не должно быть запроса на отправку уведомлений.

Оба варианта установок должны проверяться путем нескольких перезапусков приложения для проверки сохранения логики поведения приложения при втором и последующих открытиях в рамках одной установки.

# Замена Useragent

Useragent в вебвью не должен указывать на использование вебвью.

# Размер вебвью

Вебвью должен отображаться в рамках Safe Area, безопасной зоны, где вырезы в экране, status bar или navigation bar не будут перекрывать контент, отображаемый в вебвью. 

Следует проверять эту настройку во всех положениях экрана, а также после блокировки и разблокировки устройства.

# Поворот экрана

Приложение должно позволять пользователю повернуть экран стандартными средствами системы, либо поддерживать автоповорот на основе сенсоров устройства. Это включает в себя кнопку ручного поворота экрана на Android. 
Все возможные загрузочные экраны и вебвью должны адаптироваться к положению экрана.

# Возврат назад

Вебвью должен поддерживать возврат на прошлую страницу кнопками или жестами, стандартными для этой операционной системы.

То же действие с первой страницы сайта не должно приводить к закрытию вебвью.

# Множественные редиректы

Приложение должно без ошибок обрабатывать большое количество редиректов. В случае возникновения ошибки ERR_TOO_MANY_REDIRECTS приложение **должно продолжать** загрузку страницы по указанному адресу.

# Поддержка Javascript

Приложение должно поддерживать работу Javascript на сайтах.

# Поддержка Cookie

Приложение должно поддерживать работу Cookie на сайтах.

# Поддержка сессий

Приложение должно поддерживать работу сессий на сайтах.

# Поддержка inline autoplay video

Вебвью должен поддерживать автовоспроизведение видео на сайтах без его раскрытия на полный экран и без необходимости запускать его вручную.

# Поддержка автоматического разрешения **protected content**

Вебвью должен поддерживать автоматическое подтверждение доступа к P**rotected Media ID** для запросов на странице. (В большинстве браузеров включено по умолчанию).
Пример для UniWebView: 

`uniWebView.RegisterOnRequestMediaCapturePermission(permission => UniWebViewMediaCapturePermissionDecision.Grant);` 

# Получение параметров

Приложение должно передавать в ссылку ряд параметров, описанных в документации.

# Загрузка файлов

Вебвью должен поддерживать загрузку файлов на сайты без запроса доступа к файловой системе устройства.

В рамках тестового ресурса также проверяется загрузка файлов с запросом к камере. Если эта функция поддерживается приложением, она обязательна для тестирования, но допустимо, если приложение поддерживает загрузку файлов только из памяти устройства.

# Перекрытие контента клавиатурой

Открытие вирутальной клавиатуры не должно приводить к перекрытию этой клавиатурой активного поля ввода.

# Получение уведомлений

Приложение должно быть настроено на получение уведомлений. Уведомления тестируются с помощью специальной ссылки с параметром af_id, передающим уникальный идентификатор установки.

# Отображение уведомлений

Тестовое уведомление должно помимо заголовка и текста содержать изображение и кастомную иконку (только для Android).

# Открытие уведомления

Нажатие на уведомление должно приводить к запуску приложения с кастомной ссылкой, полученной из уведомления. Данная ссылка является одноразовой, она не должна запускаться при следующем запуске приложения.

# Запуск новой ссылки

При втором запуске приложение должно получить новую ссылку, которая будет открыта в вебвью. 

# Переход по диплинку

Приложение должно правильно обрабатывать диплинки внутри вебвью.

Если вебвью не поддерживает диплинки изначально, следует отлавливать переходы по ним и передавать их системе, например, с помощью `new Intent` или `Application.OpenURL`. Также необходимо возвращать пользователя на прошлую страницу, чтобы при возвращении в приложение он не видел ошибки.