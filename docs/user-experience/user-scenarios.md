# Сценарии пользовательского взаимодействия

## Обзор

Данный документ описывает основные сценарии взаимодействия пользователя с приложением, включая первый запуск, последующие запуски и работу с уведомлениями.

## Содержание

- [1. Первый запуск](#1-первый-запуск)
- [2. Последующие запуски](#2-последующие-запуски)
- [3. Работа с push-уведомлениями](#3-работа-с-push-уведомлениями)

---

## 1. Первый запуск

Первый запуск приложения требует активного интернет-соединения. В зависимости от данных конверсии, полученных от **Appsflyer**, возможны следующие сценарии:

<aside>
⚠️

Есть вероятность ложного статуса конверсии со стороны AppsFlyer! Для того чтобы минимизировать влияние этого фактора требуется после получения конверсии проверить поле `af_status`, если его значение `Organic` необходимо сделать повторный запрос конверсии через **5 секунд** используя метод **API**:
https://dev.appsflyer.com/hc/reference/gcd-get-data. Для принятия дальнейших решений и отправки запросов следует использовать последние успешно полученные данные конверсии.

</aside>

- **1.1 Условие запуска WebView выполняется:**
    - Приложение отправляет запрос на [**эндпоинт**](https://www.notion.so/742144532ce0403988b0689e3f942982?pvs=21) и получает положительный ответ и ссылку для **WebView**.
        - Ссылка должна быть сохранена для использования в сценарии п. 2.1.
    - Пользователю отображается **WebView**.
    - Режим устанавливается как **WebView**, и при последующих запусках приложение должно открываться в этом режиме.
- **1.2 Условие запуска WebView не выполняется:**
    - Приложение отправляет запрос на [**эндпоинт**](https://www.notion.so/742144532ce0403988b0689e3f942982?pvs=21) и получает отрицательный ответ.
    - Пользователь попадает на **фантик (игра или другой контент)**.
    - Режим устанавливается как **фантик**, и при последующих запусках приложение должно открываться в этом режиме.
- **1.3 Отсутствует интернет:**
    - Приложение не может отправить запрос на **эндпоинт**.
    - Возможные сценарии:
        1. Заглушка
            - Пользователь получает **заглушку "Нет интернета"**.
                
                Опционально такая заглушка может содержать кнопку Retry, которая будет проверять соединение и повторять попытку загрузки согласно п. 1.1.
                
            - После восстановления соединения и/или повторного запуска приложения проходит сценарий первого запуска согласно п. 1.1 и 1.2.
        2. Переход на фантик, режим приложения сохраняется как **“Режим фантик”**.

### **2. Последующие запуски**

При повторном открытии приложение должно запускаться в ранее установленном режиме:

- **2.1 Режим WebView:**
    - Если при первом запуске был показан **WebView**, он должен открываться при каждом последующем запуске.
    - Ссылка для отображения запрашивается через **эндпоинт**, в случае если **эндпоинт** не отвечает **WebView** должен отобразить последнюю успешно полученную ссылку.
    - Если интернет отсутствует, возможны варианты:
        - Отображается заглушка "Нет интернета" (Предпочтительный вариант).
        - WebView все же загружается, но отображает пустой экран.
- **2.2 Режим фантик:**
    - Если при первом запуске был показан **фантик**, при последующих запусках пользователь также попадает на **фантик**.
    - Интернет требуется только при первом запуске, поэтому в дальнейшем **фантик** отображается независимо от наличия сети.
        - Допустимо поведение заглушки "Нет интернета" аналогичное режиму WebView.

### **3. Работа с push-уведомлениями**

<aside>
❔

Для уведомлений используется Firebase Messaging

</aside>

- При первом запуске **в режиме WebView** приложение должно показать кастомный экран запроса разрешения на уведомления, в случае если пользователь согласен, появляется системный запрос разрешения на уведомления (в случае андроида для SDK 33 и выше). Если пользователь отказывается должен происходить повторный запрос через 3 дня.
Подробнее в разделе [Настройка и работа с уведомлениями](https://www.notion.so/9a6adf9687ea4c6aabba80785ce1333e?pvs=21).
- В дальнейшем приложение может получать и обрабатывать push-уведомления в фоновом режиме.
- Пуш уведомления должны иметь кастомную иконку и поддерживать отображение картинок. Пуши могут содержать ссылку, при нажатии на уведомление она должна открываться в приложении.